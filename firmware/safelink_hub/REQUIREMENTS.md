# SafeLink Vest Hub 요구사항서

## 1. 개요
SafeLink Vest Hub는 웨어러블 밴드의 센서 데이터를 수집하고, 환경 소음을 모니터링하여 작업자에게 종합적인 안전 정보를 제공하는 허브 디바이스입니다.

## 2. 하드웨어 요구사항

### 2.1 메인 컨트롤러
- **MCU**: ESP32-C6 (경량형 구성)
  - WiFi 6 지원
  - Bluetooth 5 (LE) 지원
  - 저전력 모드 지원
  - 듀얼 코어 240MHz

### 2.2 센서 모듈
- **소음 센서**: 디지털 마이크로폰 (MEMS)
  - 측정 범위: 30-130 dB
  - 측정 정확도: ±2 dB
  - 샘플링 주파수: 44.1kHz
  - A-weighting 필터링

### 2.3 출력 모듈
- **스피커**: 1W 모노 스피커
  - 주파수 범위: 300Hz-8kHz
  - 음성 경고 출력
  - 볼륨 조절 가능

- **진동 모터**: 코인 진동 모터
  - 진동 강도 조절 가능
  - PWM 제어

- **LED 표시등**: RGB LED x 3개
  - 상태 표시 (정상/경고/위험)
  - 밝기 조절 가능

### 2.4 전원 관리
- **배터리**: 3000mAh Li-Po 배터리
- **충전**: USB-C 충전 포트
- **배터리 수명**: 최소 48시간 (스탠바이 모드)
- **저전력 설계**: 적응형 전력 관리

### 2.5 통신 모듈
- **BLE Scanner**: 웨어러블 밴드 데이터 수신
- **BLE GATT Server**: 모바일 앱과의 통신
- **WiFi**: 클라우드 연결 (선택적)
- **확장 포트**: I2C, UART 커넥터

### 2.6 확장 인터페이스
- **I2C 포트**: 추가 센서 연결
- **UART 포트**: 외부 모듈 통신
- **GPIO 포트**: 디지털 I/O 확장

## 3. 소프트웨어 요구사항

### 3.1 데이터 수집 및 처리
- 웨어러블 밴드로부터 BLE Advertising 데이터 수신
- 환경 소음 실시간 측정 및 분석
- 다중 디바이스 동시 모니터링 (최대 10개)
- 데이터 융합 및 상관관계 분석

### 3.2 소음 모니터링 기준
#### 3.2.1 소음 노출 기준
- **95dB 이상 10분**: 누적 노출시간 4.2% 초과시 경고
- **110dB 이상 10분**: 누적 노출시간 33% 초과시 위험
- **130dB 충격음 100회**: 일일 노출횟수 10% 초과시 위험

#### 3.2.2 실시간 소음 감지
- **지속적 고소음**: 90dB 이상 5분 지속시 경고
- **급격한 소음 증가**: 20dB 이상 급상승시 즉시 경고
- **충격음 감지**: 120dB 이상 순간 소음 감지

### 3.3 안전 상태 종합 판단
#### 3.3.1 개별 위험도 평가
- 웨어러블 밴드 생체신호 분석
- 환경 소음 위험도 평가
- 작업 시간 및 휴식 패턴 분석

#### 3.3.2 종합 위험도 계산
- **정상 상태**: 모든 지표 안전 범위
- **주의 상태**: 1개 이상 지표 경고 범위
- **경고 상태**: 2개 이상 지표 경고 또는 1개 위험
- **위험 상태**: 2개 이상 지표 위험 범위

### 3.4 경고 및 알림 시스템
#### 3.4.1 단계별 경고
- **1단계 (주의)**: LED 황색, 약한 진동
- **2단계 (경고)**: LED 적색, 강한 진동, 짧은 경고음
- **3단계 (위험)**: LED 깜빡임, 연속 진동, 음성 경고

#### 3.4.2 음성 경고 메시지
- "소음이 위험합니다. 귀마개를 착용하세요."
- "체온이 높습니다. 즉시 휴식하세요."
- "심박수가 위험합니다. 작업을 중단하세요."
- "종합 위험도가 높습니다. 안전 조치를 취하세요."

### 3.5 통신 프로토콜
#### 3.5.1 BLE Scanner (웨어러블 밴드 수신)
- Advertising 패킷 스캔
- 디바이스 식별 및 페어링
- 데이터 파싱 및 검증

#### 3.5.2 BLE GATT Server (모바일 앱 통신)
- 종합 센서 데이터 서비스
- 설정 및 제어 서비스
- 알림 및 경고 서비스

#### 3.5.3 WiFi 통신
- 클라우드 데이터 동기화
- OTA 업데이트
- 원격 모니터링

### 3.6 전원 관리
- **활성 모드**: 모든 기능 동작
- **절약 모드**: 스캔 주기 감소
- **대기 모드**: 최소 기능만 동작
- **충전 모드**: 충전 중 최적화

## 4. 기능 요구사항

### 4.1 핵심 기능
- 다중 웨어러블 디바이스 모니터링
- 실시간 환경 소음 측정
- 종합 안전 상태 분석
- 즉각적인 위험 경고

### 4.2 사용자 인터페이스
- LED를 통한 시각적 상태 표시
- 진동을 통한 촉각적 경고
- 음성을 통한 청각적 경고
- 모바일 앱을 통한 상세 정보

### 4.3 관리 기능
- 디바이스 등록 및 해제
- 임계치 설정 및 조정
- 경고 메시지 커스터마이징
- 사용 통계 및 리포트

### 4.4 확장 기능
- 외부 센서 모듈 연결
- 산업별 맞춤 설정
- 다국어 음성 지원
- 클라우드 연동

## 5. 성능 요구사항

### 5.1 응답성
- BLE 스캔 주기: 100ms
- 소음 측정 주기: 100ms
- 위험 감지 응답: 500ms 이내
- 앱 데이터 전송: 1초 이내

### 5.2 동시 처리 능력
- 동시 모니터링 디바이스: 최대 10개
- BLE 연결 유지: 최대 3개
- 데이터 처리 지연: 100ms 이내

### 5.3 안정성
- 연속 동작 시간: 최소 48시간
- 데이터 손실률: 0.1% 미만
- 시스템 복구 시간: 10초 이내

### 5.4 정확도
- 소음 측정 정확도: ±2dB
- 위험 감지 정확도: 95% 이상
- 오경보율: 5% 미만

## 6. 환경 요구사항

### 6.1 작동 환경
- 온도: -20°C ~ 70°C
- 습도: 5% ~ 95% RH
- 방진/방수: IP66 등급
- 진동: IEC 68-2-6 준수

### 6.2 내구성
- 낙하 충격: 2m 높이
- 동작 수명: 최소 3년
- 충전 사이클: 1000회 이상

### 6.3 소음 환경
- 측정 가능 소음: 30-130dB
- 주변 소음 간섭: 최소화
- 마이크 보호: 방수/방진 처리

## 7. 안전 및 규제 요구사항

### 7.1 안전 기준
- 전기 안전: IEC 62368-1
- 무선 인증: FCC, CE, KC
- 배터리 안전: UN38.3

### 7.2 산업 안전 기준
- 소음 측정: IEC 61672
- 개인보호장비: EN 397
- 작업장 안전: OSHA 1926

## 8. 개발 우선순위

### Phase 1 (MVP)
1. BLE 스캐닝 및 데이터 수신
2. 기본 소음 측정
3. LED/진동 경고 시스템
4. 모바일 앱 BLE 통신

### Phase 2
1. 음성 경고 시스템
2. 다중 디바이스 관리
3. 종합 위험도 분석
4. 확장 포트 지원

### Phase 3
1. WiFi 클라우드 연동
2. 고급 소음 분석
3. 머신러닝 위험 예측
4. OTA 업데이트

## 9. 데이터 흐름

### 9.1 입력 데이터
- 웨어러블 밴드: 심박수, 체온, WBGT
- 소음 센서: 환경 소음 레벨
- 사용자 설정: 임계치, 알림 설정

### 9.2 처리 과정
- 데이터 수집 → 전처리 → 융합 분석 → 위험도 평가 → 경고 생성

### 9.3 출력 데이터
- 모바일 앱: 종합 대시보드 데이터
- 로컬 경고: LED, 진동, 음성
- 클라우드: 장기 통계 및 분석

## 10. 시스템 아키텍처

### 10.1 하드웨어 아키텍처
```
ESP32-C6 Core
├── BLE Controller (웨어러블 스캐닝)
├── BLE GATT Server (앱 통신)
├── I2S Audio (소음 측정/음성 출력)
├── PWM (진동/LED 제어)
├── I2C/UART (확장 포트)
└── ADC (배터리 모니터링)
```

### 10.2 소프트웨어 아키텍처
```
Application Layer
├── Safety Monitor
├── Device Manager
├── Audio Manager
└── Alert Manager

Communication Layer
├── BLE Scanner
├── BLE Server
└── WiFi Manager

Hardware Abstraction Layer
├── Sensor Drivers
├── Audio Drivers
└── Power Management
``` 